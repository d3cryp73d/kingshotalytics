<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth Status</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple animation for the loading spinner */
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app" class="min-h-screen flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-lg transition-all">
            <h1 class="text-2xl font-bold mb-6 text-center text-gray-800">User Authentication</h1>
            
            <!-- Status Display -->
            <div id="user-status" class="text-lg text-center text-gray-700 p-4 bg-gray-50 rounded-lg flex items-center justify-center space-x-3">
                <!-- Loading Spinner (initially visible) -->
                <svg id="loader" class="animate-spin h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span id="status-text">Checking auth status...</span>
            </div>

            <!-- User ID Display -->
            <div id="user-id" class="text-sm text-gray-500 mt-4 break-words text-center min-h-[40px]"></div>

            <!-- Login Options (initially hidden) -->
            <div id="login-options" class="mt-6 text-center hidden">
                <button id="google-signin-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center justify-center w-full">
                    <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611 20.083H42v-0.083H24v8h11.303c-1.649 4.657-6.08 8-11.303 8-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 12.955 4 4 12.955 4 24s8.955 20 20 20 20-8.955 20-20c0-2.56-0.198-5.021-0.57-7.439z"/><path fill="#FF3D00" d="M6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 16.318 4 9.656 8.337 6.306 14.691z"/><path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238C29.211 35.091 26.715 36 24 36c-5.223 0-9.657-3.356-11.303-7.932l-6.573 4.817C9.864 39.931 16.446 44 24 44z"/><path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303c-0.792 2.237-2.231 4.166-4.087 5.574l6.19 5.238C39.986 35.666 44 30.134 44 24c0-2.56-0.198-5.021-0.57-7.439z"/></svg>
                    Sign in with Google
                </button>
            </div>

            <!-- Sign Out Button Container (initially hidden) -->
            <div id="sign-out-container" class="mt-6 text-center hidden">
                <button id="sign-out-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    Sign Out
                </button>
            </div>
        </div>

        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>This version implements Google Sign-In for user authentication.</p>
        </footer>
    </div>

    <script type="module">
        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        window.addEventListener('DOMContentLoaded', async () => {
            // --- DOM Element References ---
            const userStatusContainer = document.getElementById('user-status');
            const userIdElement = document.getElementById('user-id');
            const loader = document.getElementById('loader');
            const loginOptionsContainer = document.getElementById('login-options');
            const googleSignInBtn = document.getElementById('google-signin-btn');
            const signOutContainer = document.getElementById('sign-out-container');
            const signOutBtn = document.getElementById('sign-out-btn');
            
            // --- Icon SVGs ---
            const loggedInIcon = `<svg class="h-6 w-6 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-7a2 2 0 00-2-2H6a2 2 0 00-2 2v7a2 2 0 002 2z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 9V6a3 3 0 013-3v0a3 3 0 013 3v3" /></svg>`;
            const loggedOutIcon = `<svg class="h-6 w-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-7a2 2 0 00-2-2H6a2 2 0 00-2 2v7a2 2 0 002 2z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 9V6a3 3 0 013-3v0a3 3 S0 013 3v3m1-3h-1" /></svg>`;
            
            try {
                // --- Firebase Configuration & Initialization ---
                const firebaseConfig = typeof __firebase_config !== 'undefined' 
                    ? JSON.parse(__firebase_config) 
                    : {
                        apiKey: "AIzaSyB8vos_zTcted2kqLkSB5zfn1DlBY3h_pA",
                        authDomain: "alliance-stats-2.firebaseapp.com",
                        projectId: "alliance-stats-2",
                        storageBucket: "alliance-stats-2.appspot.com",
                        messagingSenderId: "617989983517",
                        appId: "1:617989983517:web:ba23e62f9818c0b6d8e5f4",
                        measurementId: "G-TYW4Q3QDMJ"
                      };
                
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);

                // --- UI Update Function ---
                const updateUI = (user) => {
                    loader.classList.add('hidden');
                    if (user) {
                        userStatusContainer.innerHTML = `${loggedInIcon} <span class="font-semibold text-green-600">Logged In</span>`;
                        const displayName = user.displayName ? ` (${user.displayName})` : '';
                        userIdElement.innerHTML = `Welcome back${displayName}!<br/><span class="text-xs text-gray-400">UID: ${user.uid}</span>`;
                        signOutContainer.classList.remove('hidden');
                        loginOptionsContainer.classList.add('hidden');
                    } else {
                        userStatusContainer.innerHTML = `${loggedOutIcon} <span class="font-semibold text-red-600">Logged Out</span>`;
                        userIdElement.textContent = 'Please sign in to continue.';
                        signOutContainer.classList.add('hidden');
                        loginOptionsContainer.classList.remove('hidden');
                    }
                };
                
                // --- Event Listeners ---
                onAuthStateChanged(auth, updateUI);

                googleSignInBtn.addEventListener('click', async () => {
                    const provider = new GoogleAuthProvider();
                    try {
                        const result = await signInWithPopup(auth, provider);
                        console.log("Successfully signed in with Google:", result.user.displayName);
                    } catch (error) {
                        console.error("Error signing in with Google:", error);
                        userIdElement.textContent = `Google sign-in error: ${error.message}`;
                    }
                });

                signOutBtn.addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        console.log("User signed out successfully.");
                    } catch (error) {
                        console.error("Error signing out:", error);
                        userIdElement.textContent = `Error signing out: ${error.message}`;
                    }
                });

            } catch (error) {
                console.error("An error occurred during Firebase initialization:", error);
                loader.classList.add('hidden');
                userStatusContainer.innerHTML = `<span class="font-semibold text-red-600">Initialization Error</span>`;
                userIdElement.textContent = `Details: ${error.message}`;
            }
        });
    </script>
</body>
</html>

